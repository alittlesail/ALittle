{
if (typeof ALittleIDE === "undefined") window.ALittleIDE = {};
let ___all_struct = ALittle.GetAllStruct();

ALittle.RegStruct(1883782801, "ALittle.UILButtonDownEvent", {
name : "ALittle.UILButtonDownEvent", ns_name : "ALittle", rl_name : "UILButtonDownEvent", hash_code : 1883782801,
name_list : ["target","abs_x","abs_y","rel_x","rel_y","count","is_drag"],
type_list : ["ALittle.DisplayObject","double","double","double","double","int","bool"],
option_map : {}
})
ALittle.RegStruct(1715346212, "ALittle.Event", {
name : "ALittle.Event", ns_name : "ALittle", rl_name : "Event", hash_code : 1715346212,
name_list : ["target"],
type_list : ["ALittle.EventDispatcher"],
option_map : {}
})
ALittle.RegStruct(-1676610185, "ALittle.UISystemSaveFileEvent", {
name : "ALittle.UISystemSaveFileEvent", ns_name : "ALittle", rl_name : "UISystemSaveFileEvent", hash_code : -1676610185,
name_list : ["target","path"],
type_list : ["ALittle.DisplayObject","string"],
option_map : {}
})
ALittle.RegStruct(-1604617962, "ALittle.UIKeyDownEvent", {
name : "ALittle.UIKeyDownEvent", ns_name : "ALittle", rl_name : "UIKeyDownEvent", hash_code : -1604617962,
name_list : ["target","mod","sym","scancode","custom","handled"],
type_list : ["ALittle.DisplayObject","int","int","int","bool","bool"],
option_map : {}
})
ALittle.RegStruct(-1479093282, "ALittle.UIEvent", {
name : "ALittle.UIEvent", ns_name : "ALittle", rl_name : "UIEvent", hash_code : -1479093282,
name_list : ["target"],
type_list : ["ALittle.DisplayObject"],
option_map : {}
})
ALittle.RegStruct(-1347278145, "ALittle.UIButtonEvent", {
name : "ALittle.UIButtonEvent", ns_name : "ALittle", rl_name : "UIButtonEvent", hash_code : -1347278145,
name_list : ["target","abs_x","abs_y","rel_x","rel_y","count","is_drag"],
type_list : ["ALittle.DisplayObject","double","double","double","double","int","bool"],
option_map : {}
})
ALittle.RegStruct(1337289812, "ALittle.UIButtonDragEvent", {
name : "ALittle.UIButtonDragEvent", ns_name : "ALittle", rl_name : "UIButtonDragEvent", hash_code : 1337289812,
name_list : ["target","rel_x","rel_y","delta_x","delta_y","abs_x","abs_y"],
type_list : ["ALittle.DisplayObject","double","double","double","double","double","double"],
option_map : {}
})
ALittle.RegStruct(1301789264, "ALittle.UIButtonDragBeginEvent", {
name : "ALittle.UIButtonDragBeginEvent", ns_name : "ALittle", rl_name : "UIButtonDragBeginEvent", hash_code : 1301789264,
name_list : ["target","rel_x","rel_y","delta_x","delta_y","abs_x","abs_y"],
type_list : ["ALittle.DisplayObject","double","double","double","double","double","double"],
option_map : {}
})
ALittle.RegStruct(-1202439334, "ALittle.UIMoveOutEvent", {
name : "ALittle.UIMoveOutEvent", ns_name : "ALittle", rl_name : "UIMoveOutEvent", hash_code : -1202439334,
name_list : ["target"],
type_list : ["ALittle.DisplayObject"],
option_map : {}
})
ALittle.RegStruct(1043339049, "ALittleIDE.IDEUITabChildSearchInfo", {
name : "ALittleIDE.IDEUITabChildSearchInfo", ns_name : "ALittleIDE", rl_name : "IDEUITabChildSearchInfo", hash_code : 1043339049,
name_list : ["name","index"],
type_list : ["string","int"],
option_map : {}
})
ALittle.RegStruct(-959526497, "ALittleIDE.IDEUITabChildHandleInfo", {
name : "ALittleIDE.IDEUITabChildHandleInfo", ns_name : "ALittleIDE", rl_name : "IDEUITabChildHandleInfo", hash_code : -959526497,
name_list : ["display_group","handle_quad","focus_quad","size_quad_container","target","buttondown_lock","buttondown_count","delta_x","delta_y","lock_x_or_y","delta_width","delta_height","lock_width_or_height"],
type_list : ["ALittle.DisplayObject","ALittle.DisplayObject","ALittle.DisplayObject","ALittle.DisplayObject","ALittleIDE.IDEUITreeLogic","bool","int","double","double","bool","double","double","bool"],
option_map : {}
})
ALittle.RegStruct(882286932, "ALittle.UIKeyEvent", {
name : "ALittle.UIKeyEvent", ns_name : "ALittle", rl_name : "UIKeyEvent", hash_code : 882286932,
name_list : ["target","mod","sym","scancode","custom","handled"],
type_list : ["ALittle.DisplayObject","int","int","int","bool","bool"],
option_map : {}
})
ALittle.RegStruct(-641444818, "ALittle.UIRButtonDownEvent", {
name : "ALittle.UIRButtonDownEvent", ns_name : "ALittle", rl_name : "UIRButtonDownEvent", hash_code : -641444818,
name_list : ["target","abs_x","abs_y","rel_x","rel_y","count","is_drag"],
type_list : ["ALittle.DisplayObject","double","double","double","double","int","bool"],
option_map : {}
})
ALittle.RegStruct(544684311, "ALittle.UIMoveInEvent", {
name : "ALittle.UIMoveInEvent", ns_name : "ALittle", rl_name : "UIMoveInEvent", hash_code : 544684311,
name_list : ["target"],
type_list : ["ALittle.DisplayObject"],
option_map : {}
})
ALittle.RegStruct(456283290, "ALittleIDE.IDEUITabChildControlLine", {
name : "ALittleIDE.IDEUITabChildControlLine", ns_name : "ALittleIDE", rl_name : "IDEUITabChildControlLine", hash_code : 456283290,
name_list : ["quad","size_quad","size_quad_container"],
type_list : ["ALittle.DisplayObject","ALittle.DisplayObject","ALittle.DisplayObject"],
option_map : {}
})
ALittle.RegStruct(-431205740, "ALittle.UIResizeEvent", {
name : "ALittle.UIResizeEvent", ns_name : "ALittle", rl_name : "UIResizeEvent", hash_code : -431205740,
name_list : ["target"],
type_list : ["ALittle.DisplayObject"],
option_map : {}
})
ALittle.RegStruct(-370908646, "ALittleIDE.IDEUITabChildQuickDragAddUserData", {
name : "ALittleIDE.IDEUITabChildQuickDragAddUserData", ns_name : "ALittleIDE", rl_name : "IDEUITabChildQuickDragAddUserData", hash_code : -370908646,
name_list : ["abs_x","abs_y","module_name","control_name"],
type_list : ["double","double","string","string"],
option_map : {}
})
ALittle.RegStruct(150587926, "ALittle.UIButtonDragEndEvent", {
name : "ALittle.UIButtonDragEndEvent", ns_name : "ALittle", rl_name : "UIButtonDragEndEvent", hash_code : 150587926,
name_list : ["target","rel_x","rel_y","delta_x","delta_y","abs_x","abs_y"],
type_list : ["ALittle.DisplayObject","double","double","double","double","double","double"],
option_map : {}
})
ALittle.RegStruct(40651933, "ALittle.UILButtonUpEvent", {
name : "ALittle.UILButtonUpEvent", ns_name : "ALittle", rl_name : "UILButtonUpEvent", hash_code : 40651933,
name_list : ["target","abs_x","abs_y","rel_x","rel_y","count","is_drag"],
type_list : ["ALittle.DisplayObject","double","double","double","double","int","bool"],
option_map : {}
})

if (ALittleIDE.IDETabChild === undefined) throw new Error(" extends class:ALittleIDE.IDETabChild is undefined");
ALittleIDE.IDEUITabChild = JavaScript.Class(ALittleIDE.IDETabChild, {
	Ctor : function(ctrl_sys, module, name, save) {
		ALittleIDE.g_IDECenter.center.AddEventListener(___all_struct.get(-506107723), this, this.HandleShowSelectLayer);
		ALittleIDE.g_IDECenter.center.AddEventListener(___all_struct.get(1299500288), this, this.HandleShowHandDragLayer);
		ALittleIDE.g_IDECenter.center.AddEventListener(___all_struct.get(2103672497), this, this.HandleShowScaleLayer);
		ALittleIDE.g_IDEProject.AddEventListener(___all_struct.get(1787992834), this, this.HandleProjectSettingChanged);
		this._group = ALittle.CreateKeyWeakMap();
		this._tab_screen = ALittleIDE.g_Control.CreateControl("ide_edit_tab_screen", this);
		this._tree_screen = ALittleIDE.g_Control.CreateControl("ide_edit_tree_screen", this);
		this._attr_screen = ALittleIDE.g_Control.CreateControl("ide_edit_attr_screen", this);
		this._anti_panel = ALittleIDE.g_Control.CreateControl("ide_edit_anti_panel", this);
		this._tree_object = undefined;
		this._tab_screen.container.scale_x = 1;
		this._tab_screen.container.scale_y = 1;
		this._tab_container.width = ALittleIDE.g_IDEProject.project.config.GetConfig("default_show_width", 800);
		this._tab_container.height = ALittleIDE.g_IDEProject.project.config.GetConfig("default_show_height", 600);
		this._tab_container.x = 100;
		this._tab_container.y = 100;
		this._tab_rb_quad.x = this._tab_container.x + this._tab_container.width + 100;
		this._tab_rb_quad.y = this._tab_container.y + this._tab_container.height + 100;
		this._tab_screen.AdjustScrollBar();
		this._tab_select_container.visible = ALittleIDE.g_IDECenter.center.singleselect;
		this._tab_handle_quad.AddEventListener(___all_struct.get(1883782801), this, this.HandleHandleContainerLButtonDown);
		this._tab_handle_quad.AddEventListener(___all_struct.get(40651933), this, this.HandleHandleContainerLButtonUp);
		this._tab_handle_quad.AddEventListener(___all_struct.get(1301789264), this, this.HandleHandleContainerDragBegin);
		this._tab_handle_quad.AddEventListener(___all_struct.get(1337289812), this, this.HandleHandleContainerDrag);
		this._tab_handle_quad.AddEventListener(___all_struct.get(150587926), this, this.HandleHandleContainerDragEnd);
		this._tab_select_rect.visible = false;
		this._tab_quad_container.RemoveAllChild();
		this._tab_quad_map = new Map();
		this._tab_handdrag_container.visible = ALittleIDE.g_IDECenter.center.handdrag;
		this._tab_handdrag_quad.drag_trans_target = this._tab_screen;
		this._tab_scale_container.visible = ALittleIDE.g_IDECenter.center.scale;
		this._tab_scale_quad.AddEventListener(___all_struct.get(1883782801), this, this.HandleScaleContainerLButtonDown);
		this._tree_search_info = {};
		this._tree_search_info.name = "";
		this._tree_search_info.index = 0;
		this._tab_screen._user_data = this;
		this._tree_screen._user_data = this;
		this._tree_loop_x = undefined;
		this._tree_loop_y = undefined;
		this.AddEventListener(___all_struct.get(-1676610185), this, this.HandleSavePng);
	},
	OnHide : function() {
		this._tree_screen.visible = false;
		this._attr_screen.visible = false;
		this._anti_panel.visible = false;
		ALittleIDE.g_IDECenter.center.tool_ui.visible = false;
		ALittleIDE.g_IDEAttrControlDialog.SetTitle("");
		ALittleIDE.g_IDEAttrControlDialog.HideDialog();
		ALittleIDE.g_IDECenter.center.RemoveEventListener(___all_struct.get(1408180774), this, this.HandleEditScaleChanged);
	},
	OnShow : function() {
		this._tree_screen.visible = true;
		this._attr_screen.visible = true;
		this._anti_panel.visible = true;
		ALittleIDE.g_IDECenter.center.tool_ui.visible = true;
		let panel_childs = this._attr_screen.childs;
		if (panel_childs[1 - 1] !== undefined) {
			ALittleIDE.g_IDEAttrControlDialog.SetTitle(panel_childs[1 - 1]._user_data.title);
		}
		ALittleIDE.g_IDECenter.center.UpdateToolScale(this.GetScale());
		ALittleIDE.g_IDECenter.center.AddEventListener(___all_struct.get(1408180774), this, this.HandleEditScaleChanged);
	},
	OnClose : function() {
		ALittleIDE.g_IDECenter.center.control_tree.RemoveChild(this._tree_screen);
		ALittleIDE.g_IDEAttrControlDialog.attr_container.RemoveChild(this._attr_screen);
		ALittleIDE.g_IDECenter.center.control_anti.RemoveChild(this._anti_panel);
		ALittleIDE.g_IDEProject.RemoveEventListener(___all_struct.get(1787992834), this, this.HandleProjectSettingChanged);
		ALittleIDE.g_IDECenter.center.RemoveEventListener(___all_struct.get(1408180774), this, this.HandleEditScaleChanged);
		ALittleIDE.g_IDECenter.center.RemoveEventListener(___all_struct.get(-506107723), this, this.HandleShowSelectLayer);
		ALittleIDE.g_IDECenter.center.RemoveEventListener(___all_struct.get(1299500288), this, this.HandleShowHandDragLayer);
		ALittleIDE.g_IDECenter.center.RemoveEventListener(___all_struct.get(2103672497), this, this.HandleShowScaleLayer);
	},
	OnOpen : function() {
		ALittleIDE.g_IDECenter.center.control_tree.AddChild(this._tree_screen);
		ALittleIDE.g_IDEAttrControlDialog.attr_container.AddChild(this._attr_screen);
		ALittleIDE.g_IDECenter.center.control_anti.AddChild(this._anti_panel);
	},
	ShowInCenter : function() {
		let object = this._tree_object.user_info.object;
		let [x, y] = object.LocalToGlobal(this._tab_object_container);
		if (x > 0 && y > 0) {
			let real_width = this._tab_object_container.width - this._tab_screen.view_width;
			if (object.width < this._tab_object_container.width && real_width > 0) {
				let view_x = this._tab_screen.view_width / 2;
				let center_x = x + object.width / 2;
				this._tab_screen.bottom_scrollbar.offset_rate = (center_x - view_x) / real_width;
			}
			let real_height = this._tab_object_container.height - this._tab_screen.view_height;
			if (object.height < this._tab_object_container.height && real_height > 0) {
				let view_y = this._tab_screen.view_height / 2;
				let center_y = y + object.height / 2;
				this._tab_screen.right_scrollbar.offset_rate = (center_y - view_y) / real_height;
			}
			this._tab_screen.AdjustScrollBar();
		}
	},
	OnTabRightMenu : function(menu) {
		menu.AddItem("截图导出", A_OtherSystem.SystemSaveFile.bind(A_OtherSystem, this, this._name + ".png", undefined));
		menu.AddItem("复制控件名", ALittle.System_SetClipboardText.bind(undefined, this._name));
		menu.AddItem("复制继承代码", this.CopyExtends.bind(this));
		menu.AddItem("刷新", this.Refresh.bind(this));
		menu.AddItem("获取焦点", this.ShowControlFocus.bind(this));
	},
	CopyExtends : function() {
		let display_info = {};
		display_info.__module = this._module;
		display_info.__extends = this._name;
		let copy_list = [];
		let info = {};
		info.index = 1;
		info.info = display_info;
		copy_list[1 - 1] = info;
		ALittle.System_SetClipboardText(ALittle.String_JsonEncode(copy_list));
	},
	HandleProjectSettingChanged : function(event) {
		this._tab_container.width = event.default_show_width;
		this._tab_container.height = event.default_show_height;
		this._tab_screen.AdjustScrollBar();
		for (let [target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			this.UpdateHandleQuadLayout(target);
		}
	},
	HandleTreeSizeChanged : function(event) {
		this._tree_screen.AdjustScrollBar();
	},
	HandleSavePng : function(event) {
		ALittleIDE.g_Control.SaveControlToFile(this._tree_object.user_info.object, event.path);
	},
	get tab_body() {
		return this._tab_screen;
	},
	get edit_screen() {
		return this._edit_screen;
	},
	get tree_screen() {
		return this._tree_screen;
	},
	get attr_screen() {
		return this._attr_screen;
	},
	get anti_panel() {
		return this._anti_panel;
	},
	get group() {
		return this._group;
	},
	get tree_object() {
		return this._tree_object;
	},
	set save(value) {
		if (this._save === value) {
			return;
		}
		if (value === false) {
			this._save = false;
			this.UpdateTitle();
			return;
		}
		if (this._tree_object === undefined) {
			return;
		}
		let ui_manager = ALittleIDE.g_IDEProject.GetUIManager(this._module);
		if (ui_manager === undefined) {
			g_AUITool.ShowNotice("错误", "模块不存在:" + this._module);
			return;
		}
		let info = this._tree_object.CalcInfo();
		let create = ui_manager.control_map[this._name] === undefined;
		let error = ui_manager.SaveControl(this._name, info);
		if (error !== undefined) {
			return;
		}
		if (create) {
			let tree = ALittleIDE.g_IDECenter.center.control_list.GetControlTree(this._module);
			if (tree !== undefined) {
				tree.Refresh();
			}
		}
		this._save = value;
		this.UpdateTitle();
	},
	Rename : function(name) {
		this._name = name;
		this.UpdateTitle();
	},
	UpdateTitle : function() {
		if (this._tree_object === undefined) {
			return;
		}
		let text = this._tree_object.GetDesc();
		if (text === "") {
			text = this._name;
			if (ALittle.String_Len(this._name) > 30) {
				text = "..." + ALittle.String_Sub(this._name, -30, -1);
			}
		}
		if (this._save === false) {
			text = text + " *";
		}
		ALittleIDE.g_IDECenter.center.content_edit.main_tab.SetChildText(this._tab_screen, text);
	},
	get title() {
		let text = this._tree_object.GetDesc();
		if (text === "") {
			return this._name;
		}
		return this._name + "(" + text + ")";
	},
	SelectAlign : function(align_type) {
		let count = 0;
		let first_target = undefined;
		for (let [target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			count = count + 1;
			first_target = target;
		}
		if (count === 0) {
			return;
		}
		if (first_target === this._tree_object) {
			return;
		}
		if (count === 1) {
			let parent = first_target.logic_parent;
			let parent_object = parent.user_info.object;
			let drag_x = 0.0;
			let drag_y = 0.0;
			let target_object = first_target.user_info.object;
			if (align_type === "h_align_left") {
				drag_x = -target_object.x;
			} else if (align_type === "h_align_center") {
				drag_x = (parent_object.width - target_object.width) / 2 - target_object.x;
			} else if (align_type === "h_align_right") {
				drag_x = (parent_object.width - target_object.width) - target_object.x;
			} else if (align_type === "v_align_top") {
				drag_y = -target_object.y;
			} else if (align_type === "v_align_center") {
				drag_y = (parent_object.height - target_object.height) / 2 - target_object.y;
			} else if (align_type === "v_align_bottom") {
				drag_y = (parent_object.height - target_object.height) - target_object.y;
			}
			first_target.DragXY(drag_x, drag_y);
			this.UpdateHandleQuadLayout(first_target);
			let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, first_target, drag_x, drag_y);
			this._revoke_list.PushRevoke(revoke);
		} else {
			let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
			if (align_type === "h_align_left") {
				let common = first_target.user_info.object.x;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					if (target.user_info.object.x < common) {
						common = target.user_info.object.x;
					}
				}
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					let drag_x = common - target.user_info.object.x;
					target.DragXY(drag_x, 0);
					this.UpdateHandleQuadLayout(target);
					let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, drag_x, 0);
					revoke_bind.PushRevoke(revoke);
				}
			} else if (align_type === "h_align_center") {
				let common = 0.0;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					common = common + target.user_info.object.x + target.user_info.object.width / 2;
				}
				common = common / count;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					let drag_x = common - (target.user_info.object.x + target.user_info.object.width / 2);
					target.DragXY(drag_x, 0);
					this.UpdateHandleQuadLayout(target);
					let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, drag_x, 0);
					revoke_bind.PushRevoke(revoke);
				}
			} else if (align_type === "h_align_right") {
				let common = first_target.user_info.object.x + first_target.user_info.object.width;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					if (target.user_info.object.x + target.user_info.object.width > common) {
						common = target.user_info.object.x + target.user_info.object.width;
					}
				}
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					let drag_x = common - (target.user_info.object.x + target.user_info.object.width);
					target.DragXY(drag_x, 0);
					this.UpdateHandleQuadLayout(target);
					let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, drag_x, 0);
					revoke_bind.PushRevoke(revoke);
				}
			} else if (align_type === "v_align_top") {
				let common = first_target.user_info.object.y;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					if (target.user_info.object.y < common) {
						common = target.user_info.object.y;
					}
				}
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					let drag_y = common - target.user_info.object.y;
					target.DragXY(0, drag_y);
					this.UpdateHandleQuadLayout(target);
					let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, 0, drag_y);
					revoke_bind.PushRevoke(revoke);
				}
			} else if (align_type === "v_align_center") {
				let common = 0.0;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					common = common + target.user_info.object.y + target.user_info.object.height / 2;
				}
				common = common / count;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					let drag_y = common - (target.user_info.object.y + target.user_info.object.height / 2);
					target.DragXY(0, drag_y);
					this.UpdateHandleQuadLayout(target);
					let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, 0, drag_y);
					revoke_bind.PushRevoke(revoke);
				}
			} else if (align_type === "v_align_bottom") {
				let common = first_target.user_info.object.y + first_target.user_info.object.height;
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					if (target.user_info.object.y + target.user_info.object.height > common) {
						common = target.user_info.object.y + target.user_info.object.height;
					}
				}
				for (let [target, v] of this._tab_quad_map) {
					if (v === undefined) continue;
					let drag_y = common - (target.user_info.object.y + target.user_info.object.height);
					target.DragXY(0, drag_y);
					this.UpdateHandleQuadLayout(target);
					let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, 0, drag_y);
					revoke_bind.PushRevoke(revoke);
				}
			}
			this._revoke_list.PushRevoke(revoke_bind);
		}
		this.save = false;
	},
	HandleShowSelectLayer : function(event) {
		this._tab_select_container.visible = event.value;
	},
	HandleShowHandDragLayer : function(event) {
		this._tab_handdrag_container.visible = event.value;
	},
	HandleShowScaleLayer : function(event) {
		this._tab_scale_container.visible = event.value;
	},
	Refresh : function() {
		let ui_manager = ALittleIDE.g_IDEProject.GetUIManager(this._module);
		if (ui_manager === undefined) {
			return;
		}
		let control_info = ui_manager.control_map[this._name];
		if (control_info === undefined) {
			return;
		}
		let object = ui_manager.control.CreateControl(this._name);
		this._tab_object_container.RemoveAllChild();
		this._tab_object_container.AddChild(object);
		this._tree_object = ALittleIDE.IDEUIUtility_CreateTree(control_info.info, this._module, false, object, undefined, this, true);
		this._tree_object.AddEventListener(___all_struct.get(-431205740), this, this.HandleTreeSizeChanged);
		this._tree_object.fold = true;
		this._tree_screen.RemoveAllChild();
		this._tree_screen.AddChild(this._tree_object);
		this._anti_panel.Init(this);
		this._group = ALittle.CreateKeyWeakMap();
		this._tab_quad_container.RemoveAllChild();
		this._tab_quad_map = new Map();
		this._tree_search_info = {};
		this._tree_search_info.name = "";
		this._tree_search_info.index = 0;
		this._save = true;
		this.UpdateTitle();
		this._revoke_list = ALittle.NewObject(ALittle.RevokeList);
	},
	ShowControlFocus : function() {
		let tree = ALittleIDE.g_IDECenter.center.control_list.GetControlTree(this._module);
		if (tree === undefined) {
			return;
		}
		let ___OBJECT_1 = tree.childs;
		for (let index = 1; index <= ___OBJECT_1.length; ++index) {
			let child = ___OBJECT_1[index - 1];
			if (child === undefined) break;
			if (child.user_info.name === this._name) {
				ALittleIDE.g_IDECenter.center.project_edit_tab.tab = ALittleIDE.g_IDECenter.center.control_list;
				ALittleIDE.g_IDECenter.center.control_list.ShowTreeItemFocus(child);
				return;
			}
		}
	},
	CreateByNew : function(type) {
		let ui_manager = ALittleIDE.g_IDEProject.GetUIManager(this._module);
		if (ui_manager === undefined) {
			return;
		}
		let info = {};
		info.__class = type;
		let object = ALittle.NewObject(ALittle[type], ui_manager.control);
		ALittleIDE.IDEUIUtility_NewGiveBaseCase(info, object);
		this._tab_object_container.AddChild(object);
		this._tree_object = ALittleIDE.IDEUIUtility_CreateTree(info, this._module, false, object, undefined, this, true);
		this._tree_object.AddEventListener(___all_struct.get(-431205740), this, this.HandleTreeSizeChanged);
		this._tree_object.fold = true;
		this._tree_screen.AddChild(this._tree_object);
		this._anti_panel.Init(this);
	},
	CreateByExtends : function(extends_module, extends_name) {
		let extends_ui = ALittleIDE.g_IDEProject.GetUIManager(extends_module);
		if (extends_ui === undefined) {
			return false;
		}
		if (extends_ui.control_map[extends_name] === undefined) {
			return false;
		}
		let info = {};
		info.__module = extends_module;
		info.__extends = extends_name;
		let object = extends_ui.control.CreateControl(extends_name);
		this._tab_object_container.AddChild(object);
		this._tree_object = ALittleIDE.IDEUIUtility_CreateTree(info, this._module, false, object, undefined, this, true);
		this._tree_object.AddEventListener(___all_struct.get(-431205740), this, this.HandleTreeSizeChanged);
		this._tree_object.fold = true;
		this._tree_screen.AddChild(this._tree_object);
		this._anti_panel.Init(this);
		return true;
	},
	CreateBySelect : function(info) {
		let ui_manager = ALittleIDE.g_IDEProject.GetUIManager(this._module);
		if (ui_manager === undefined) {
			return;
		}
		let object = ui_manager.control.CreateControl(ALittle.File_GetJustFileNameByPath(this._name));
		this._tab_object_container.AddChild(object);
		this._tree_object = ALittleIDE.IDEUIUtility_CreateTree(info, this._module, false, object, undefined, this, true);
		this._tree_object.AddEventListener(___all_struct.get(-431205740), this, this.HandleTreeSizeChanged);
		this._tree_object.fold = true;
		this._tree_screen.AddChild(this._tree_object);
		this._anti_panel.Init(this);
	},
	IsShowHandleQuad : function(target) {
		return this._tab_quad_map.get(target) !== undefined;
	},
	FocusInHandleQuad : function(target) {
		let handle_info = this._tab_quad_map.get(target);
		if (handle_info === undefined) {
			return;
		}
		A_UISystem.focus = handle_info.focus_quad;
	},
	ClearHandQuad : function() {
		this._tab_quad_map = new Map();
		this._tab_quad_container.RemoveAllChild();
	},
	ShowHandleQuad : function(target, force_shift) {
		let shift = (A_UISystem.sym_map.get(1073742049) !== undefined || A_UISystem.sym_map.get(1073742053) !== undefined);
		if (force_shift) {
			shift = true;
		}
		let ctrl = (A_UISystem.sym_map.get(1073742048) !== undefined || A_UISystem.sym_map.get(1073742052) !== undefined);
		if (shift) {
			ctrl = false;
		}
		if (shift === false && ctrl === false) {
			this._tab_quad_map = new Map();
			this._tab_quad_container.RemoveAllChild();
		}
		let common_parent = undefined;
		let has_target = false;
		for (let [tree_target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			common_parent = tree_target.logic_parent;
			has_target = true;
			break;
		}
		if (has_target && common_parent !== target.logic_parent) {
			let parent = target.logic_parent;
			while (parent !== undefined && common_parent !== parent) {
				target = parent;
				parent = parent.logic_parent;
			}
			if (parent === undefined) {
				return;
			}
		}
		let list = [];
		if (!has_target || common_parent === undefined || ctrl) {
			list[1 - 1] = target;
		} else {
			let max_index = common_parent.GetChildIndex(target);
			let min_index = max_index;
			for (let [child, info] of this._tab_quad_map) {
				if (info === undefined) continue;
				let index = common_parent.GetChildIndex(child);
				if (index < min_index) {
					min_index = index;
				} else if (index > max_index) {
					max_index = index;
				}
			}
			for (let index = min_index; index <= max_index; index += 1) {
				let child = common_parent.GetChildByIndex(index);
				if (this._tab_quad_map.get(child) === undefined) {
					ALittle.List_Push(list, child);
				}
			}
		}
		let ___OBJECT_2 = list;
		for (let index = 1; index <= ___OBJECT_2.length; ++index) {
			let child = ___OBJECT_2[index - 1];
			if (child === undefined) break;
			let control_line = {};
			let handle_quad = ALittleIDE.g_Control.CreateControl("aui_handle_quad", control_line);
			control_line.quad.AddEventListener(___all_struct.get(40651933), this, this.HandleHandleQuadLButtonUp);
			control_line.quad.AddEventListener(___all_struct.get(1883782801), this, this.HandleHandleQuadLButtonDown);
			control_line.quad.AddEventListener(___all_struct.get(1301789264), this, this.HandleHandleQuadDragBegin);
			control_line.quad.AddEventListener(___all_struct.get(1337289812), this, this.HandleHandleQuadDrag);
			control_line.quad.AddEventListener(___all_struct.get(150587926), this, this.HandleHandleQuadDragEnd);
			control_line.quad.AddEventListener(___all_struct.get(-641444818), this, this.HandleHandleQuadRButtonDown);
			control_line.quad.AddEventListener(___all_struct.get(-1604617962), this, this.HandleHandleQuadKeyDown);
			control_line.size_quad.AddEventListener(___all_struct.get(-1604617962), this, this.HandleHandleQuadKeyDown);
			control_line.size_quad.AddEventListener(___all_struct.get(1301789264), this, this.HandleHandleSizeQuadDragBegin);
			control_line.size_quad.AddEventListener(___all_struct.get(1337289812), this, this.HandleHandleSizeQuadDrag);
			control_line.size_quad.AddEventListener(___all_struct.get(150587926), this, this.HandleHandleSizeQuadDragEnd);
			control_line.size_quad.AddEventListener(___all_struct.get(544684311), this, this.HandleHandleSizeQuadMoveIn);
			control_line.size_quad.AddEventListener(___all_struct.get(-1202439334), this, this.HandleHandleSizeQuadMoveOut);
			let handle_info = {};
			let target_parent = child.user_info.object;
			let quad_parent = handle_quad;
			while (target_parent !== undefined) {
				quad_parent.x = target_parent.x;
				quad_parent.y = target_parent.y;
				quad_parent.width = target_parent.width;
				quad_parent.height = target_parent.height;
				quad_parent.scale_x = target_parent.scale_x;
				quad_parent.scale_y = target_parent.scale_y;
				quad_parent.center_x = target_parent.center_x;
				quad_parent.center_y = target_parent.center_y;
				quad_parent.angle = target_parent.angle;
				let display_group = ALittle.NewObject(ALittle.DisplayGroup, ALittleIDE.g_Control);
				display_group.AddChild(quad_parent);
				if (target_parent.show_parent === this._tab_object_container) {
					handle_info.display_group = display_group;
					this._tab_quad_container.AddChild(display_group);
					break;
				}
				quad_parent = display_group;
				target_parent = target_parent.show_parent;
			}
			handle_info.handle_quad = handle_quad;
			handle_info.focus_quad = control_line.quad;
			handle_info.size_quad_container = control_line.size_quad_container;
			control_line.quad._user_data = handle_info;
			control_line.size_quad._user_data = handle_info;
			child.ShowAttributePanel();
			handle_info.target = child;
			this._tab_quad_map.set(child, handle_info);
		}
		let loop = ALittle.NewObject(ALittle.LoopFunction, this.FocusInHandleQuad.bind(this, target), 1, 0, 1);
		loop.Start();
	},
	ShowHandleQuadList : function(list) {
		this._tab_quad_map = new Map();
		this._tab_quad_container.RemoveAllChild();
		let target = undefined;
		let ___OBJECT_3 = list;
		for (let index = 1; index <= ___OBJECT_3.length; ++index) {
			let child = ___OBJECT_3[index - 1];
			if (child === undefined) break;
			target = child;
			let control_line = {};
			let handle_quad = ALittleIDE.g_Control.CreateControl("ide_common_handle_quad", control_line);
			control_line.quad.AddEventListener(___all_struct.get(40651933), this, this.HandleHandleQuadLButtonUp);
			control_line.quad.AddEventListener(___all_struct.get(1883782801), this, this.HandleHandleQuadLButtonDown);
			control_line.quad.AddEventListener(___all_struct.get(1301789264), this, this.HandleHandleQuadDragBegin);
			control_line.quad.AddEventListener(___all_struct.get(1337289812), this, this.HandleHandleQuadDrag);
			control_line.quad.AddEventListener(___all_struct.get(150587926), this, this.HandleHandleQuadDragEnd);
			control_line.quad.AddEventListener(___all_struct.get(-641444818), this, this.HandleHandleQuadRButtonDown);
			control_line.quad.AddEventListener(___all_struct.get(-1604617962), this, this.HandleHandleQuadKeyDown);
			control_line.size_quad.AddEventListener(___all_struct.get(-1604617962), this, this.HandleHandleQuadKeyDown);
			control_line.size_quad.AddEventListener(___all_struct.get(1301789264), this, this.HandleHandleSizeQuadDragBegin);
			control_line.size_quad.AddEventListener(___all_struct.get(1337289812), this, this.HandleHandleSizeQuadDrag);
			control_line.size_quad.AddEventListener(___all_struct.get(150587926), this, this.HandleHandleSizeQuadDragEnd);
			control_line.size_quad.AddEventListener(___all_struct.get(544684311), this, this.HandleHandleSizeQuadMoveIn);
			control_line.size_quad.AddEventListener(___all_struct.get(-1202439334), this, this.HandleHandleSizeQuadMoveOut);
			let handle_info = {};
			let target_parent = child.user_info.object;
			let quad_parent = handle_quad;
			while (target_parent !== undefined) {
				quad_parent.x = target_parent.x;
				quad_parent.y = target_parent.y;
				quad_parent.width = target_parent.width;
				quad_parent.height = target_parent.height;
				quad_parent.scale_x = target_parent.scale_x;
				quad_parent.scale_y = target_parent.scale_y;
				quad_parent.center_x = target_parent.center_x;
				quad_parent.center_y = target_parent.center_y;
				quad_parent.angle = target_parent.angle;
				let display_group = ALittle.NewObject(ALittle.DisplayGroup, ALittleIDE.g_Control);
				display_group.AddChild(quad_parent);
				if (target_parent.show_parent === this._tab_object_container) {
					handle_info.display_group = display_group;
					this._tab_quad_container.AddChild(display_group);
					break;
				}
				quad_parent = display_group;
				target_parent = target_parent.show_parent;
			}
			handle_info.handle_quad = handle_quad;
			handle_info.focus_quad = control_line.quad;
			handle_info.size_quad_container = control_line.size_quad_container;
			control_line.quad._user_data = handle_info;
			control_line.size_quad._user_data = handle_info;
			child.ShowAttributePanel();
			handle_info.target = child;
			this._tab_quad_map.set(child, handle_info);
		}
		if (target === undefined) {
			return;
		}
		let loop = ALittle.NewObject(ALittle.LoopFunction, this.FocusInHandleQuad.bind(this, target), 1, 0, 1);
		loop.Start();
	},
	HideHandleQuad : function(target, shift) {
		let handle_info = this._tab_quad_map.get(target);
		if (handle_info === undefined) {
			return;
		}
		if (shift === undefined) {
			shift = (A_UISystem.sym_map.get(1073742049) !== undefined || A_UISystem.sym_map.get(1073742053) !== undefined);
		}
		let ctrl = (A_UISystem.sym_map.get(1073742048) !== undefined || A_UISystem.sym_map.get(1073742052) !== undefined);
		if (shift) {
			ctrl = false;
		}
		if (shift === false && ctrl === false) {
			this._tab_quad_map = new Map();
			this._tab_quad_container.RemoveAllChild();
			target.ShowAttributePanel();
			this._tab_quad_map.set(handle_info.target, handle_info);
			this._tab_quad_container.AddChild(handle_info.display_group);
			return;
		}
		this._tab_quad_container.RemoveChild(handle_info.display_group);
		this._tab_quad_map.delete(handle_info.target);
	},
	UpdateHandleQuadLayout : function(target) {
		let handle_info = this._tab_quad_map.get(target);
		if (handle_info === undefined) {
			return;
		}
		handle_info.handle_quad.x = target.user_info.object.x;
		handle_info.handle_quad.y = target.user_info.object.y;
		handle_info.handle_quad.width = target.user_info.object.width;
		handle_info.handle_quad.height = target.user_info.object.height;
		handle_info.handle_quad.scale_x = target.user_info.object.scale_x;
		handle_info.handle_quad.scale_y = target.user_info.object.scale_y;
		handle_info.handle_quad.center_x = target.user_info.object.center_x;
		handle_info.handle_quad.center_y = target.user_info.object.center_y;
		handle_info.handle_quad.angle = target.user_info.object.angle;
	},
	UpdateHandleQuadRemove : function(target) {
		let handle_info = this._tab_quad_map.get(target);
		if (handle_info === undefined) {
			return;
		}
		this._tab_quad_container.RemoveChild(handle_info.handle_quad);
		this._tab_quad_map.delete(target);
	},
	HandleHandleContainerLButtonDown : function(event) {
		this._container_drag = false;
	},
	HandleHandleContainerLButtonUp : function(event) {
		if (this._container_drag) {
			return;
		}
		if (this._tree_object === undefined) {
			return;
		}
		let target = this._tree_object.EditPickUp(event.rel_x, event.rel_y);
		if (target === undefined) {
			return;
		}
		this.ShowHandleQuad(target);
	},
	HandleHandleContainerDragBegin : function(event) {
		this.ClearHandQuad();
		let target = this._tree_object.EditPickUp(event.rel_x, event.rel_y);
		if (target === undefined) {
			return;
		}
		this._container_drag_x = event.rel_x;
		this._container_drag_y = event.rel_y;
		this._container_drag_parent = target.logic_parent;
		this._tab_select_rect.visible = true;
		this._tab_select_rect.x = this._container_drag_x;
		this._tab_select_rect.y = this._container_drag_y;
		this._tab_select_rect.width = 0;
		this._tab_select_rect.height = 0;
	},
	HandleHandleContainerDrag : function(event) {
		if (this._container_drag_x === undefined) {
			return;
		}
		let min_x = this._container_drag_x;
		let max_x = event.rel_x;
		if (this._container_drag_x > event.rel_x) {
			min_x = event.rel_x;
			max_x = this._container_drag_x;
		}
		let min_y = this._container_drag_y;
		let max_y = event.rel_y;
		if (this._container_drag_y > event.rel_y) {
			min_y = event.rel_y;
			max_y = this._container_drag_y;
		}
		this._tab_select_rect.x = min_x;
		this._tab_select_rect.y = min_y;
		this._tab_select_rect.width = max_x - min_x;
		this._tab_select_rect.height = max_y - min_y;
	},
	HandleHandleContainerDragEnd : function(event) {
		this._tab_select_rect.visible = false;
		if (this._container_drag_parent === undefined) {
			return;
		}
		let [rel_x, rel_y] = this._container_drag_parent.user_info.object.LocalToGlobal(this._edit_screen);
		let [offset_x, offset_y] = this._container_drag_parent.user_info.object.GetChildOffset();
		rel_x = rel_x + (offset_x);
		rel_y = rel_y + (offset_y);
		let min_x = this._container_drag_x;
		let max_x = event.rel_x;
		if (this._container_drag_x > event.rel_x) {
			min_x = event.rel_x;
			max_x = this._container_drag_x;
		}
		min_x = min_x - (rel_x);
		max_x = max_x - (rel_x);
		let min_y = this._container_drag_y;
		let max_y = event.rel_y;
		if (this._container_drag_y > event.rel_y) {
			min_y = event.rel_y;
			max_y = this._container_drag_y;
		}
		min_y = min_y - (rel_y);
		max_y = max_y - (rel_y);
		let list = [];
		let ___OBJECT_4 = this._container_drag_parent.childs;
		for (let index = 1; index <= ___OBJECT_4.length; ++index) {
			let tree_logic = ___OBJECT_4[index - 1];
			if (tree_logic === undefined) break;
			if (tree_logic.SelectPickRange(min_x, min_y, max_x, max_y)) {
				ALittle.List_Push(list, tree_logic);
			}
		}
		this.ShowHandleQuadList(list);
		this._container_drag_x = undefined;
		this._container_drag_y = undefined;
		this._container_drag_parent = undefined;
		this._container_drag = true;
	},
	HandleSelectRightExItemClick : function(event) {
		let tree = event.target._user_data;
		if (tree === undefined) {
			return;
		}
		this.ShowHandleQuad(tree);
	},
	HandleScaleContainerLButtonDown : function(event) {
		let shift = (A_UISystem.sym_map.get(1073742049) !== undefined || A_UISystem.sym_map.get(1073742053) !== undefined);
		let scale = this._tab_screen.container.scale_x;
		if (shift) {
			scale = scale - 0.1;
			if (scale < 0) {
				scale = 0;
			}
		} else {
			scale = scale + 0.1;
		}
		this._tab_screen.container.scale_x = scale;
		this._tab_screen.container.scale_y = scale;
		this._tab_screen.AdjustScrollBar();
		ALittleIDE.g_IDECenter.center.UpdateToolScale(scale);
	},
	HandleEditScaleChanged : function(event) {
		this._tab_screen.container.scale_x = event.scale;
		this._tab_screen.container.scale_y = event.scale;
		this._tab_screen.AdjustScrollBar();
	},
	GetScale : function() {
		return this._tab_screen.container.scale_x;
	},
	HandleHandleQuadLButtonDown : function(event) {
		let handle_info = event.target._user_data;
		handle_info.buttondown_lock = true;
		handle_info.buttondown_count = event.count;
	},
	HandleHandleQuadLButtonUp : function(event) {
		let handle_info = event.target._user_data;
		if (handle_info.buttondown_lock !== true) {
			return;
		}
		this.HideHandleQuad(handle_info.target);
		if (handle_info.buttondown_count >= 2) {
			ALittleIDE.g_IDEAttrControlDialog.ShowDialog(handle_info.target.user_info.object);
		} else {
			ALittleIDE.g_IDEAttrControlDialog.HideDialog();
		}
	},
	ControlCopyInfoCmp : function(a, b) {
		return a.index < b.index;
	},
	HandleHandleQuadKeyDown : function(event) {
		if (event.sym === 99 && ALittle.BitAnd(event.mod, 0x00c0) !== 0) {
			let copy_list = [];
			let copy_list_count = 0;
			for (let [target, handle_info] of this._tab_quad_map) {
				if (handle_info === undefined) continue;
				if (handle_info.target.logic_parent !== undefined) {
					let info = {};
					info.module = this._module;
					info.index = handle_info.target.logic_parent.GetChildIndex(handle_info.target);
					info.info = handle_info.target.CalcInfo();
					++ copy_list_count;
					copy_list[copy_list_count - 1] = info;
				}
			}
			if (copy_list_count > 0) {
				ALittle.List_Sort(copy_list, ALittleIDE.IDEUITabChild.ControlCopyInfoCmp);
				ALittle.System_SetClipboardText(ALittle.String_JsonEncode(copy_list));
			}
			return;
		}
		if (event.sym === 120 && ALittle.BitAnd(event.mod, 0x00c0) !== 0) {
			let copy_list = [];
			let copy_list_count = 0;
			for (let [target, handle_info] of this._tab_quad_map) {
				if (handle_info === undefined) continue;
				let info = {};
				info.module = this._module;
				info.index = handle_info.target.logic_parent.GetChildIndex(handle_info.target);
				info.info = handle_info.target.CalcInfo();
				++ copy_list_count;
				copy_list[copy_list_count - 1] = info;
			}
			if (copy_list_count > 0) {
				ALittle.List_Sort(copy_list, ALittleIDE.IDEUITabChild.ControlCopyInfoCmp);
				ALittle.System_SetClipboardText(ALittle.String_JsonEncode(copy_list));
				let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
				for (let [target, handle_info] of this._tab_quad_map) {
					if (handle_info === undefined) continue;
					handle_info.target.TreeCut(revoke_bind);
				}
				this._revoke_list.PushRevoke(revoke_bind);
			}
			return;
		}
		if (event.sym === 127) {
			let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
			let has_target = false;
			for (let [target, handle_info] of this._tab_quad_map) {
				if (handle_info === undefined) continue;
				handle_info.target.TreeDelete(revoke_bind);
				has_target = true;
			}
			if (has_target) {
				this._tab_quad_map = new Map();
				this._tab_quad_container.RemoveAllChild();
				this._revoke_list.PushRevoke(revoke_bind);
			}
			return;
		}
		if (event.sym === 118 && ALittle.BitAnd(event.mod, 0x00c0) !== 0) {
			let handle_info = event.target._user_data;
			let common_parent = handle_info.target.logic_parent;
			let child_index = 1;
			if (common_parent === undefined) {
				common_parent = handle_info.target;
			} else {
				child_index = common_parent.GetChildIndex(handle_info.target) + 1;
			}
			this.RightControlTreePasteImpl(common_parent, undefined, child_index);
			return;
		}
		let delta_x = 0;
		let delta_y = 0;
		if (event.sym === 1073741904) {
			delta_x = -1;
		} else if (event.sym === 1073741903) {
			delta_x = 1;
		} else if (event.sym === 1073741906) {
			delta_y = -1;
		} else if (event.sym === 1073741905) {
			delta_y = 1;
		} else {
			return;
		}
		let common_parent = undefined;
		for (let [tree_target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			common_parent = tree_target.logic_parent;
			break;
		}
		if (common_parent === undefined) {
			return;
		}
		if (ALittleIDE.g_IDEEnum.can_move_child_map[common_parent.user_info.default.__class] === undefined) {
			return;
		}
		let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
		let has_target = false;
		for (let [target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			target.DragXY(delta_x, delta_y);
			this.UpdateHandleQuadLayout(target);
			has_target = true;
			let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, delta_x, delta_y);
			revoke_bind.PushRevoke(revoke);
		}
		if (has_target === false) {
			return;
		}
		this._revoke_list.PushRevoke(revoke_bind);
		this.save = false;
	},
	HandleHandleQuadDragBegin : function(event) {
		let common_parent = undefined;
		for (let [tree_target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			common_parent = tree_target.logic_parent;
			break;
		}
		if (common_parent === undefined) {
			return;
		}
		if (ALittleIDE.g_IDEEnum.can_move_child_map[common_parent.user_info.default.__class] === undefined) {
			return;
		}
		for (let [target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			handle_info.delta_x = 0;
			handle_info.delta_y = 0;
			handle_info.lock_x_or_y = undefined;
			handle_info.buttondown_lock = false;
		}
		this.save = false;
	},
	HandleHandleQuadDrag : function(event) {
		let common_parent = undefined;
		for (let [tree_target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			common_parent = tree_target.logic_parent;
			break;
		}
		if (common_parent === undefined) {
			return;
		}
		if (ALittleIDE.g_IDEEnum.can_move_child_map[common_parent.user_info.default.__class] === undefined) {
			return;
		}
		let shift = (A_UISystem.sym_map.get(1073742049) !== undefined || A_UISystem.sym_map.get(1073742053) !== undefined);
		for (let [target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			let delta_x = event.delta_x;
			let delta_y = event.delta_y;
			if (shift) {
				if (handle_info.lock_x_or_y === undefined) {
					handle_info.lock_x_or_y = ALittle.Math_Abs(delta_x) > ALittle.Math_Abs(delta_y);
				}
				if (handle_info.lock_x_or_y) {
					delta_y = 0;
				} else {
					delta_x = 0;
				}
			} else {
				handle_info.lock_x_or_y = undefined;
			}
			let old_abs_x = event.abs_x - delta_x;
			let old_abs_y = event.abs_y - delta_y;
			let [old_rel_x, old_rel_y] = target.user_info.object.show_parent.GlobalToLocalMatrix2D(old_abs_x, old_abs_y);
			let [new_rel_x, new_rel_y] = target.user_info.object.show_parent.GlobalToLocalMatrix2D(event.abs_x, event.abs_y);
			delta_x = new_rel_x - old_rel_x;
			delta_y = new_rel_y - old_rel_y;
			target.DragXY(delta_x, delta_y);
			this.UpdateHandleQuadLayout(target);
			handle_info.delta_x = handle_info.delta_x + delta_x;
			handle_info.delta_y = handle_info.delta_y + delta_y;
		}
	},
	HandleHandleQuadDragEnd : function(event) {
		let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
		let has_target = false;
		for (let [target, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			has_target = true;
			let revoke = ALittle.NewObject(ALittleIDE.IDEDragXYRevoke, target, handle_info.delta_x, handle_info.delta_y);
			revoke_bind.PushRevoke(revoke);
		}
		if (has_target === false) {
			return;
		}
		this._revoke_list.PushRevoke(revoke_bind);
	},
	HandleHandleQuadRButtonDown : function(event) {
		let handle_info = event.target._user_data;
		let target = handle_info.target;
		let menu = ALittle.NewObject(AUIPlugin.AUIRightMenu);
		menu.AddItem("获取焦点", this.ShowTreeItemFocus.bind(this, target));
		menu.AddItem("拾取父节点", this.PickParent.bind(this, target), target.user_info.root);
		menu.AddItem("设置", ALittleIDE.g_IDEAttrControlDialog.ShowDialog.bind(ALittleIDE.g_IDEAttrControlDialog, target.user_info.object));
		menu.AddItem("文本编辑", this.TextEdit.bind(this, target), ALittleIDE.g_IDEEnum.text_edit_display_map[target.user_info.default.__class] === undefined);
		menu.AddItem("上移", target.TransferUp.bind(target), target.user_info.root || target.user_info.child_type !== "child");
		menu.AddItem("下移", target.TransferDown.bind(target), target.user_info.root || target.user_info.child_type !== "child");
		menu.AddItem("添加", ALittleIDE.g_IDECenter.center.control_tree.ShowAddDialog.bind(ALittleIDE.g_IDECenter.center.control_tree, target), !target.is_tree);
		menu.AddItem("添加Image", ALittleIDE.g_IDECenter.center.control_tree.ShowAddImageDialog.bind(ALittleIDE.g_IDECenter.center.control_tree, target), !target.is_tree);
		menu.AddItem("添加Text", ALittleIDE.g_IDECenter.center.control_tree.ShowAddTextDialog.bind(ALittleIDE.g_IDECenter.center.control_tree, target), !target.is_tree);
		menu.AddItem("复制", this.Copy.bind(this, target));
		menu.AddItem("粘贴", this.Paste.bind(this, target));
		menu.AddItem("剪切", this.Cut.bind(this, target), target.user_info.root);
		menu.AddItem("删除", this.Delete.bind(this, target), target.user_info.root);
		menu.AddItem("跳转", this.Jump.bind(this, target), !target.user_info.extends_root);
		menu.AddItem("生成成员变量代码", this.GenerateClassMember.bind(this, target), target.is_tree && target.user_info.base.__target_class === undefined && target.user_info.default.__target_class === undefined);
		menu.Show();
	},
	HandleHandleSizeQuadDragBegin : function(event) {
		let target_handle_info = event.target._user_data;
		let target = target_handle_info.target;
		let parent = target.logic_parent;
		if (parent !== undefined && ALittleIDE.g_IDEEnum.can_move_child_map[parent.user_info.default.__class] === undefined) {
			return;
		}
		for (let [child, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			handle_info.delta_width = 0;
			handle_info.delta_height = 0;
			handle_info.lock_width_or_height = undefined;
		}
		this.save = false;
	},
	HandleHandleSizeQuadDrag : function(event) {
		let handle_info = event.target._user_data;
		let target = handle_info.target;
		let parent = target.logic_parent;
		if (parent !== undefined && ALittleIDE.g_IDEEnum.can_move_child_map[parent.user_info.default.__class] === undefined) {
			return;
		}
		let shift = (A_UISystem.sym_map.get(1073742049) !== undefined || A_UISystem.sym_map.get(1073742053) !== undefined);
		let delta_x = event.delta_x;
		let delta_y = event.delta_y;
		if (shift) {
			if (handle_info.lock_width_or_height === undefined) {
				handle_info.lock_width_or_height = ALittle.Math_Abs(delta_x) > ALittle.Math_Abs(delta_y);
			}
			if (handle_info.lock_width_or_height) {
				delta_y = 0;
			} else {
				delta_x = 0;
			}
		} else {
			handle_info.lock_width_or_height = undefined;
		}
		let old_abs_x = event.abs_x - delta_x;
		let old_abs_y = event.abs_y - delta_y;
		let [old_rel_x, old_rel_y] = target.user_info.object.GlobalToLocalMatrix2D(old_abs_x, old_abs_y);
		let [new_rel_x, new_rel_y] = target.user_info.object.GlobalToLocalMatrix2D(event.abs_x, event.abs_y);
		delta_x = new_rel_x - old_rel_x;
		delta_y = new_rel_y - old_rel_y;
		let quad_width = handle_info.handle_quad.width + delta_x;
		if (quad_width < 0) {
			delta_x = -handle_info.handle_quad.width;
		}
		let quad_height = handle_info.handle_quad.height + delta_y;
		if (quad_height < 0) {
			delta_y = -handle_info.handle_quad.height;
		}
		target.DragWH(delta_x, delta_y);
		handle_info.handle_quad.width = handle_info.handle_quad.width + delta_x;
		handle_info.handle_quad.height = handle_info.handle_quad.height + delta_y;
		handle_info.delta_width = handle_info.delta_width + delta_x;
		handle_info.delta_height = handle_info.delta_height + delta_y;
		this.UpdateHandleQuadLayout(target);
	},
	HandleHandleSizeQuadDragEnd : function(event) {
		let handle_info = event.target._user_data;
		let target = handle_info.target;
		let revoke = ALittle.NewObject(ALittleIDE.IDEDragWHRevoke, target, handle_info.delta_width, handle_info.delta_height);
		this._revoke_list.PushRevoke(revoke);
	},
	HandleHandleSizeQuadMoveIn : function(event) {
		ALittle.System_SetHVDragCursor();
	},
	HandleHandleSizeQuadMoveOut : function(event) {
		ALittle.System_SetNormalCursor();
	},
	Copy : function(target) {
		let copy_list = [];
		let copy_list_count = 0;
		for (let [child, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			let info = {};
			info.index = handle_info.target.logic_parent.GetChildIndex(handle_info.target);
			info.info = handle_info.target.CalcInfo();
			++ copy_list_count;
			copy_list[copy_list_count - 1] = info;
		}
		if (copy_list_count > 0) {
			ALittle.List_Sort(copy_list, ALittleIDE.IDEUITabChild.ControlCopyInfoCmp);
			ALittle.System_SetClipboardText(ALittle.String_JsonEncode(copy_list));
		}
	},
	RightControlTreePasteImpl : function(target, copy_list, child_index, revoke_bind, callback) {
		if (copy_list === undefined) {
			let text_info = ALittle.System_GetClipboardText();
			if (text_info === undefined) {
				g_AUITool.ShowNotice("错误", "剪切板的内容不能粘帖");
				if (callback !== undefined) {
					callback(false, undefined);
				}
				return;
			}
			let [error, copy_list_tmp] = (function() { try { let ___VALUE = ALittle.String_JsonDecode.call(undefined, text_info); return [undefined, ___VALUE]; } catch (___ERROR) { return [___ERROR.message]; } }).call(this);
			if (error !== undefined || ALittle.List_MaxN(copy_list_tmp) === 0) {
				g_AUITool.ShowNotice("错误", "剪切板的内容不能粘帖");
				if (callback !== undefined) {
					callback(false, undefined);
				}
				return;
			}
			copy_list = copy_list_tmp;
		}
		let ___OBJECT_5 = copy_list;
		for (let k = 1; k <= ___OBJECT_5.length; ++k) {
			let info = ___OBJECT_5[k - 1];
			if (info === undefined) break;
			if (info.info.__class === undefined && info.info.__extends === undefined) {
				g_AUITool.ShowNotice("错误", "剪切板的内容不能粘帖");
				if (callback !== undefined) {
					callback(false, undefined);
				}
				return;
			}
			if (info.module !== undefined && info.module !== this._module) {
				g_AUITool.ShowNotice("错误", "剪切板的内容属于其他模块不能粘帖");
				if (callback !== undefined) {
					callback(false, undefined);
				}
				return;
			}
		}
		this.ClearHandQuad();
		let clazz = target.user_info.default.__class;
		if (ALittleIDE.g_IDEEnum.can_add_child_map[clazz] && ALittleIDE.g_IDEEnum.child_show_map[clazz] === undefined) {
			let add_list = [];
			let add_list_count = 0;
			let inner_revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
			let ___OBJECT_6 = copy_list;
			for (let k = 1; k <= ___OBJECT_6.length; ++k) {
				let info = ___OBJECT_6[k - 1];
				if (info === undefined) break;
				if (k === 1) {
					let tree_object = target.TreePaste(info.info, "child", child_index, false, inner_revoke_bind);
					++ add_list_count;
					add_list[add_list_count - 1] = tree_object;
				} else {
					let tree_object = target.TreePaste(info.info, "child", child_index, true, inner_revoke_bind);
					++ add_list_count;
					add_list[add_list_count - 1] = tree_object;
				}
			}
			if (revoke_bind !== undefined) {
				revoke_bind.PushRevoke(inner_revoke_bind);
			} else {
				this._revoke_list.PushRevoke(inner_revoke_bind);
			}
			if (callback !== undefined) {
				callback(true, add_list);
			}
		} else {
			ALittleIDE.g_IDECenter.center.control_tree.ShowPasteDialog(target, copy_list[1 - 1].info, child_index, revoke_bind, callback);
		}
	},
	Paste : function(target) {
		if (target.is_tree) {
			this.RightControlTreePasteImpl(target);
		} else {
			let common_parent = target.logic_parent;
			let child_index = 1;
			if (common_parent === undefined) {
				common_parent = target;
			} else {
				child_index = common_parent.GetChildIndex(target) + 1;
			}
			this.RightControlTreePasteImpl(common_parent, undefined, child_index);
		}
	},
	Delete : function(target) {
		let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
		let has_target = false;
		for (let [child, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			handle_info.target.TreeDelete(revoke_bind);
			has_target = true;
		}
		if (has_target) {
			this._tab_quad_map = new Map();
			this._tab_quad_container.RemoveAllChild();
			this._revoke_list.PushRevoke(revoke_bind);
		}
	},
	Cut : function(target) {
		let copy_list = [];
		let copy_list_count = 0;
		for (let [child, handle_info] of this._tab_quad_map) {
			if (handle_info === undefined) continue;
			let info = {};
			info.index = handle_info.target.logic_parent.GetChildIndex(handle_info.target);
			info.info = handle_info.target.CalcInfo();
			++ copy_list_count;
			copy_list[copy_list_count - 1] = info;
		}
		if (copy_list_count > 0) {
			ALittle.List_Sort(copy_list, ALittleIDE.IDEUITabChild.ControlCopyInfoCmp);
			ALittle.System_SetClipboardText(ALittle.String_JsonEncode(copy_list));
			let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
			for (let [child, handle_info] of this._tab_quad_map) {
				if (handle_info === undefined) continue;
				handle_info.target.TreeCut(revoke_bind);
			}
			this._revoke_list.PushRevoke(revoke_bind);
		}
	},
	Jump : function(target) {
		let extends_module = target.user_info.base.__module;
		if (extends_module === undefined) {
			extends_module = target.user_info.module;
		}
		let extends_name = target.user_info.base.__extends;
		let ui_manager = ALittleIDE.g_IDEProject.GetUIManager(extends_module);
		if (ui_manager === undefined) {
			return;
		}
		let control_info = ui_manager.control_map[extends_name];
		if (control_info === undefined) {
			g_AUITool.ShowNotice("错误", "控件不存在:" + extends_name);
			return;
		}
		ALittleIDE.g_IDECenter.center.content_edit.StartEditControlBySelect(extends_module, extends_name);
	},
	GenerateClassMember : async function(target) {
		if (!target.is_tree) {
			g_AUITool.ShowNotice("错误", "容器才能生成成员变量代码");
			return;
		}
		let target_class = target.user_info.base.__target_class;
		if (target_class === undefined) {
			target_class = target.user_info.default.__target_class;
		}
		if (target_class === undefined) {
			g_AUITool.ShowNotice("错误", "没有设置插件类");
			return;
		}
		if (ALittleIDE.g_IDEProject.project.code === undefined) {
			return;
		}
		let find_text = ALittle.String_Join(target_class, ".");
		let info = await ALittleIDE.g_IDEProject.project.code.FindGoto(find_text);
		if (info === undefined) {
			g_AUITool.ShowNotice("错误", "找不到插件类:" + find_text);
			return;
		}
		let tab_child = ALittleIDE.g_IDECenter.center.code_list.OpenByFullPath(info.file_path, info.line_start, info.char_start, info.line_end, info.char_end);
		if (tab_child === undefined) {
			g_AUITool.ShowNotice("错误", "找不到插件类:" + find_text);
			return;
		}
		let member_list = [];
		let ___OBJECT_7 = target.childs;
		for (let index = 1; index <= ___OBJECT_7.length; ++index) {
			let child = ___OBJECT_7[index - 1];
			if (child === undefined) break;
			child.GenerateClassMember(member_list);
		}
		if (ALittle.List_MaxN(member_list) === 0) {
			return;
		}
		let text = ALittle.String_Join(member_list, "");
		tab_child.edit.EditFocus(info.line_end + 2, 0, undefined, undefined, true);
		tab_child.edit.InsertText(text, true);
	},
	TextEdit : function(target) {
		let object = target.user_info.object;
		if (this._control_tabchild_textinput === undefined) {
			this._control_tabchild_textinput = ALittleIDE.g_Control.CreateControl("aui_rename_image_input", this);
			this._control_tabchild_textinput.width = 200;
			A_LayerManager.AddToModal(this._control_tabchild_textinput);
		}
		this._control_tabchild_textinput.visible = true;
		let [x, y] = object.LocalToGlobal();
		this._control_tabchild_textinput.text = object.text;
		this._control_tabchild_textinput.x = x;
		this._control_tabchild_textinput.y = y;
		this._control_tabchild_textinput._user_data = target;
		this._control_tabchild_textinput.SelectAll();
		A_UISystem.focus = this._control_tabchild_textinput.show_input;
	},
	PickParent : function(target) {
		let parent = target.logic_parent;
		if (parent === undefined) {
			return;
		}
		this.ShowHandleQuad(parent);
	},
	HandleRenameConfirm : function(event) {
		let target = this._control_tabchild_textinput._user_data;
		if (target === undefined) {
			return;
		}
		this._control_tabchild_textinput._user_data = undefined;
		this._control_tabchild_textinput.visible = false;
		let text = this._control_tabchild_textinput.text;
		if (text === "") {
			return;
		}
		target.ChangeText(text);
	},
	ShowTreeItemFocus : function(target) {
		if (this._tree_object === undefined) {
			return;
		}
		if (target !== this._tree_object) {
			let parent = target.logic_parent;
			while (parent !== undefined && parent !== this._tree_object) {
				parent.fold = true;
				parent = parent.logic_parent;
			}
		}
		this._tree_object.fold = true;
		this._tree_screen.AdjustScrollBar();
		let [x, y] = target.LocalToGlobal(this._tree_screen.container);
		let target_x = (this._tree_screen.view_width - target.width / 2) / 2 - x;
		let target_y = (this._tree_screen.view_height - target.height) / 2 - y;
		if (this._tree_loop_x !== undefined) {
			this._tree_loop_x.Stop();
			this._tree_loop_x = undefined;
		}
		if (this._tree_loop_y !== undefined) {
			this._tree_loop_y.Stop();
			this._tree_loop_y = undefined;
		}
		this._tree_loop_x = ALittle.NewObject(ALittle.LoopLinear, this._tree_screen, "container_x", target_x, 300, 0);
		this._tree_loop_x.Start();
		this._tree_loop_y = ALittle.NewObject(ALittle.LoopLinear, this._tree_screen, "container_y", target_y, 300, 0);
		this._tree_loop_y.Start();
	},
	SearchLink : function(name) {
		if (this._tree_object === undefined) {
			return;
		}
		if (this._tree_search_info.name !== name) {
			this._tree_search_info.name = name;
			this._tree_search_info.index = 0;
		}
		let list = this._tree_object.SearchLink(name);
		let count = ALittle.List_MaxN(list);
		if (count === 0) {
			return;
		}
		this._tree_search_info.index = this._tree_search_info.index + 1;
		this._tree_search_info.index = this._tree_search_info.index % (count + 1);
		let target = list[this._tree_search_info.index - 1];
		this.ShowTreeItemFocus(target);
		target.ShowAttributePanel();
		this.ShowHandleQuad(target);
	},
	SearchEvent : function(name) {
		if (this._tree_object === undefined) {
			return;
		}
		if (this._tree_search_info.name !== name) {
			this._tree_search_info.name = name;
			this._tree_search_info.index = 0;
		}
		let list = this._tree_object.SearchEvent(name);
		let count = ALittle.List_MaxN(list);
		if (count === 0) {
			return;
		}
		this._tree_search_info.index = this._tree_search_info.index + 1;
		this._tree_search_info.index = this._tree_search_info.index % (count + 1);
		let target = list[this._tree_search_info.index - 1];
		this.ShowTreeItemFocus(target);
		target.ShowAttributePanel();
		this.ShowHandleQuad(target);
	},
	SearchDescription : function(name) {
		if (this._tree_object === undefined) {
			return;
		}
		if (this._tree_search_info.name !== name) {
			this._tree_search_info.name = name;
			this._tree_search_info.index = 0;
		}
		let list = this._tree_object.SearchDescription(name);
		let count = ALittle.List_MaxN(list);
		if (count === 0) {
			return;
		}
		this._tree_search_info.index = this._tree_search_info.index + 1;
		this._tree_search_info.index = this._tree_search_info.index % (count + 1);
		let target = list[this._tree_search_info.index - 1];
		this.ShowTreeItemFocus(target);
		target.ShowAttributePanel();
		this.ShowHandleQuad(target);
	},
	SearchTargetClass : function(name) {
		if (this._tree_object === undefined) {
			return;
		}
		if (this._tree_search_info.name !== name) {
			this._tree_search_info.name = name;
			this._tree_search_info.index = 0;
		}
		let list = this._tree_object.SearchTargetClass(name);
		let count = ALittle.List_MaxN(list);
		if (count === 0) {
			return;
		}
		this._tree_search_info.index = this._tree_search_info.index + 1;
		this._tree_search_info.index = this._tree_search_info.index % (count + 1);
		let target = list[this._tree_search_info.index - 1];
		this.ShowTreeItemFocus(target);
		target.ShowAttributePanel();
		this.ShowHandleQuad(target);
	},
	SearchTextureName : function(name) {
		if (this._tree_object === undefined) {
			return;
		}
		if (this._tree_search_info.name !== name) {
			this._tree_search_info.name = name;
			this._tree_search_info.index = 0;
		}
		let list = this._tree_object.SearchTextureName(name);
		let count = ALittle.List_MaxN(list);
		if (count === 0) {
			return;
		}
		this._tree_search_info.index = this._tree_search_info.index + 1;
		this._tree_search_info.index = this._tree_search_info.index % (count + 1);
		let target = list[this._tree_search_info.index - 1];
		this.ShowTreeItemFocus(target);
		target.ShowAttributePanel();
		this.ShowHandleQuad(target);
	},
	QuickDragAddControl : function(abs_x, abs_y, module_name, control_name) {
		if (this._tree_object === undefined) {
			return;
		}
		let [screen_x, screen_y] = this._tab_screen.LocalToGlobal();
		if (abs_x < screen_x || abs_y < screen_y || abs_x > screen_x + this._tab_screen.width || abs_y > screen_y + this._tab_screen.height) {
			return;
		}
		let [global_x, global_y] = this._tab_handle_quad.LocalToGlobal();
		let list = [];
		this._tree_object.QuickPickUp(abs_x - global_x, abs_y - global_y, list);
		let count = ALittle.List_MaxN(list);
		if (count === 0) {
			return;
		}
		let user_data = {};
		user_data.abs_x = abs_x;
		user_data.abs_y = abs_y;
		user_data.module_name = module_name;
		user_data.control_name = control_name;
		if (count === 1) {
			this.QuickDragAddStart(list[1 - 1], user_data);
			return;
		}
		let menu = ALittle.NewObject(AUIPlugin.AUIRightMenu);
		let ___OBJECT_8 = list;
		for (let index = 1; index <= ___OBJECT_8.length; ++index) {
			let tree = ___OBJECT_8[index - 1];
			if (tree === undefined) break;
			menu.AddItem(tree.title, this.QuickDragAddStart.bind(this, tree, user_data));
		}
		menu.AddItem("取消", undefined);
	},
	QuickDragAddStart : function(tree, user_data) {
		let revoke_bind = ALittle.NewObject(ALittle.RevokeBind);
		let display_info = {};
		display_info.__module = user_data.module_name;
		display_info.__extends = user_data.control_name;
		let info = {};
		info.index = 1;
		info.info = display_info;
		let copy_list = [];
		copy_list[1 - 1] = info;
		this.RightControlTreePasteImpl(tree, copy_list, tree.child_count + 1, revoke_bind, this.QuickDragAddEnd.bind(this, tree, user_data, revoke_bind));
	},
	QuickDragAddEnd : function(tree, user_data, revoke_bind, result, add_list) {
		if (result === false) {
			return;
		}
		let [global_x, global_y] = tree.user_info.object.LocalToGlobal();
		let ___OBJECT_9 = add_list;
		for (let k = 1; k <= ___OBJECT_9.length; ++k) {
			let tree_object = ___OBJECT_9[k - 1];
			if (tree_object === undefined) break;
			tree_object.attr_panel.SetXType(1, revoke_bind);
			tree_object.attr_panel.SetYType(1, revoke_bind);
			tree_object.attr_panel.SetXValue(user_data.abs_x - global_x, revoke_bind);
			tree_object.attr_panel.SetYValue(user_data.abs_y - global_y, revoke_bind);
		}
		this._revoke_list.PushRevoke(revoke_bind);
	},
}, "ALittleIDE.IDEUITabChild");

}